# CRITICAL ISSUES FIX GUIDE

**Generated by:** LOVELESS QA Specialist
**Date:** October 13, 2025
**Purpose:** Step-by-step commands to resolve all critical blockers

---

## QUICK FIX CHECKLIST

- [ ] Fix PyTorch installation (30 min)
- [ ] Fix Python version issue (1 hour)
- [ ] Test with real audio (1 hour)
- [ ] Start and test backend (30 min)
- [ ] Run performance tests (2 hours)
- [ ] Validate security (1 hour)

---

## FIX #1: PYTORCH CUDA INSTALLATION (BLOCKER)

### Problem
PyTorch installed as CPU-only version, GPU unavailable for ML operations.

### Solution
Reinstall PyTorch with CUDA support.

### Commands
```bash
# Navigate to project
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"

# Activate virtual environment
.\venv\Scripts\activate

# Uninstall current PyTorch
pip uninstall -y torch torchvision torchaudio

# Install CUDA-enabled PyTorch
pip install torch==2.7.1+cu118 torchvision==0.22.1+cu118 torchaudio==2.7.1+cu118 --index-url https://download.pytorch.org/whl/cu118

# Verify installation
python -c "import torch; print(f'PyTorch: {torch.__version__}'); print(f'CUDA: {torch.cuda.is_available()}'); print(f'GPU: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else \"Not available\"}')"
```

### Expected Output
```
PyTorch: 2.7.1+cu118
CUDA: True
GPU: NVIDIA GeForce RTX 3070
```

### Time: 30 minutes

---

## FIX #2: PYTHON 3.13 COMPATIBILITY (BLOCKER)

### Problem
Python 3.13 removed `aifc` module, breaking librosa and quality validation.

### Solution Option A (Recommended): Use Python 3.11/3.12

```bash
# Download Python 3.11.9 from python.org
# Install to: C:\Python311

# Create new virtual environment
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
C:\Python311\python.exe -m venv venv311

# Activate new environment
.\venv311\Scripts\activate

# Install all dependencies
pip install -r requirements.txt

# Install PyTorch with CUDA
pip install torch==2.7.1+cu118 torchvision==0.22.1+cu118 torchaudio==2.7.1+cu118 --index-url https://download.pytorch.org/whl/cu118

# Verify
python -c "import librosa; import torch; print('Python:', sys.version); print('CUDA:', torch.cuda.is_available())"
```

### Solution Option B: Patch librosa to use soundfile

```bash
# Edit src/preprocessing/quality_validator.py
# Replace line 79:
#   audio, sr = librosa.load(audio_path, sr=None)
# With:
#   import soundfile as sf
#   audio, sr = sf.read(audio_path)
#   audio = audio.T if audio.ndim > 1 else audio

# Apply same fix to all librosa.load() calls
```

### Solution Option C: Wait for librosa update
**Not recommended** - No ETA for Python 3.13 support.

### Time: 1 hour

---

## FIX #3: TEST WITH REAL AUDIO (HIGH PRIORITY)

### Problem
Voice isolation fails on synthetic sine wave test audio.

### Solution
Add real audio samples to test fixtures.

### Commands
```bash
# Create test audio directory
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
mkdir -p tests/fixtures/audio

# Option A: Record test audio (10 seconds of speech)
# - Use Audacity or Windows Voice Recorder
# - Save as: tests/fixtures/audio/test_voice_10sec.wav

# Option B: Download sample audio
# Place sample files in tests/fixtures/audio/

# Verify audio files
ls -lh tests/fixtures/audio/

# Run tests with real audio
pytest tests/test_ml_pipeline_integration.py -v -k "voice_isolation"
```

### Required Test Files
1. `test_voice_10sec.wav` - 10 seconds of clear speech
2. `test_music_with_vocals.mp3` - Song with vocals
3. `test_noisy_speech.wav` - Speech with background noise

### Time: 1 hour (including recording/finding samples)

---

## FIX #4: START AND TEST BACKEND (MEDIUM PRIORITY)

### Problem
Backend server not running, cannot validate API endpoints.

### Solution
Start backend and run API tests.

### Commands
```bash
# Terminal 1: Start backend
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
python run_backend.bat

# Expected output:
# INFO:     Started server process
# INFO:     Uvicorn running on http://0.0.0.0:8000

# Terminal 2: Test backend (wait for startup)
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
.\venv\Scripts\activate

# Test health endpoint
curl http://localhost:8000/health

# Run backend tests
pytest tests/test_backend_integration.py -v

# Run security tests
pytest tests/test_backend_integration.py -m security -v
```

### Expected Results
- Backend starts successfully
- Health check returns 200 OK
- All API endpoint tests pass
- Security tests pass

### Time: 30 minutes

---

## FIX #5: RUN PERFORMANCE TESTS (REQUIRED)

### Problem
No performance validation, VRAM usage and processing times unknown.

### Solution
Execute performance benchmark suite.

### Commands
```bash
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
.\venv\Scripts\activate

# Run performance tests (requires CUDA-enabled PyTorch)
pytest tests/test_performance_benchmarks.py -v -s

# Run GPU-specific tests
pytest tests/test_performance_benchmarks.py -v -s -m gpu

# Run audio quality tests
pytest tests/test_audio_quality.py -v -s

# Generate performance report
pytest tests/test_performance_benchmarks.py::TestPerformanceSummary -v -s
```

### Success Criteria
- Preprocessing < 2 minutes (3-second audio)
- VRAM usage < 7.5 GB
- Voice isolation completes successfully
- Quality validation works

### Time: 2 hours

---

## FIX #6: SECURITY VALIDATION (REQUIRED)

### Problem
Security tests not executed, vulnerability status unknown.

### Solution
Run security test suite against backend.

### Commands
```bash
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
.\venv\Scripts\activate

# Ensure backend is running in another terminal
# python run_backend.bat

# Run all security tests
pytest tests/test_backend_integration.py -m security -v

# Test file upload security
pytest tests/test_backend_integration.py::TestFileUploadValidation -v

# Check for common vulnerabilities
# - SQL injection
# - Path traversal
# - File size limits
# - CORS configuration
```

### Security Checklist
- [ ] File upload size limits enforced
- [ ] Invalid file formats rejected
- [ ] Path traversal attempts blocked
- [ ] SQL injection protection verified
- [ ] CORS properly configured
- [ ] Input sanitization working

### Time: 1 hour

---

## COMPLETE VALIDATION WORKFLOW

### After Fixes, Run Full Test Suite

```bash
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"
.\venv\Scripts\activate

# Run all tests
pytest tests/ -v --tb=short

# Generate coverage report
pytest tests/ --cov=src --cov=backend --cov-report=html

# View results
# Open htmlcov/index.html in browser
```

---

## VERIFICATION CHECKLIST

### Environment
- [ ] PyTorch with CUDA installed
- [ ] GPU accessible to PyTorch
- [ ] Python 3.11 or 3.12 (not 3.13)
- [ ] All dependencies installed

### Testing
- [ ] ML pipeline tests: >90% pass rate
- [ ] Backend API tests: 100% pass
- [ ] Performance tests: All benchmarks met
- [ ] Security tests: No vulnerabilities
- [ ] Integration tests: Complete workflow works

### Performance
- [ ] Preprocessing < 2 min (for 3 min audio)
- [ ] VRAM usage < 7.5 GB
- [ ] Voice isolation successful
- [ ] Quality validation working

### Security
- [ ] File upload limits enforced
- [ ] Input validation working
- [ ] No SQL injection vulnerabilities
- [ ] Path traversal protected
- [ ] CORS configured correctly

### Documentation
- [ ] All tests documented
- [ ] Deployment guide created
- [ ] API documentation complete
- [ ] Troubleshooting guide available

---

## EXPECTED TIMELINE

### Day 1 (4 hours)
- 09:00-09:30: Fix PyTorch installation
- 09:30-10:30: Fix Python version issue
- 10:30-11:30: Add real audio test samples
- 11:30-12:00: Break
- 12:00-12:30: Start and test backend
- 12:30-14:00: Run performance tests

### Day 1 (3 hours)
- 14:00-15:00: Security validation
- 15:00-16:00: Fix any issues found
- 16:00-17:00: Documentation updates

### Total: 7-8 hours

---

## SUCCESS METRICS

After completing all fixes, system should achieve:

- **Test Pass Rate:** >95%
- **Code Coverage:** >80%
- **Performance Score:** >90/100
- **Security Score:** 100/100 (no vulnerabilities)
- **Production Readiness:** >85/100

---

## EMERGENCY CONTACTS

### If Issues Persist

1. **PyTorch Installation Issues**
   - Check: https://pytorch.org/get-started/locally/
   - Verify: CUDA version compatibility
   - Test: nvidia-smi and nvcc --version

2. **Python Compatibility Issues**
   - Downgrade to Python 3.11.9
   - Check: https://www.python.org/downloads/
   - Verify: python --version

3. **Audio Processing Issues**
   - Check: librosa documentation
   - Test: soundfile installation
   - Verify: ffmpeg installed

4. **Backend Issues**
   - Check: FastAPI logs
   - Test: uvicorn installation
   - Verify: Port 8000 available

---

## FINAL VALIDATION

### Before Marking as Production Ready

```bash
# Complete validation script
cd "C:\Users\Abdul\Desktop\Bari 2025 Portfolio\Speech Synthesis"

# 1. Environment check
python verify_installation.py

# 2. Run all tests
pytest tests/ -v --tb=short --cov=src --cov=backend

# 3. Performance benchmarks
pytest tests/test_performance_benchmarks.py -v

# 4. Security validation
pytest tests/test_backend_integration.py -m security -v

# 5. Generate report
pytest tests/ --html=test_report.html --self-contained-html
```

### Final Checklist
- [ ] All tests passing (>95%)
- [ ] Performance benchmarks met
- [ ] No security vulnerabilities
- [ ] Documentation complete
- [ ] Deployment tested
- [ ] Ready for production

---

**END OF FIX GUIDE**

*Generated by LOVELESS QA Specialist*
*"Fix these issues, and we're ready for production."*
